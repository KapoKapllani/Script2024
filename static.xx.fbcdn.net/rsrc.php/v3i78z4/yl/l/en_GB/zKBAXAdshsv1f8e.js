;/*FB_PKG_DELIM*/

__d("BugBar",["fbt","$","AsyncDialog","AsyncRequest","CSS","DOM","DataCollector","ErrorUtils","Event","FBLogger","Input","ODS","ReactDOM","ScreenRecordingActions","ServiceWorkerErrorUtils","SimpleXUIDialog","ge","isEmpty","nullthrows","promiseDone","react"],(function(a,b,c,d,e,f,g){var h,i,j;h||b("react");var k={_nub:null,_nubClasses:["bugNubInfo","bugNubWarning","bugNubFatal"],_taskTags:[],_taskSubscribers:[],_savedInput:null,_dialog:null,_form:null,_duplicate_task_title:null,_reactRoots:[],addMetadata:function(a){b("DataCollector").addMetadata(a)},getMetadata:function(){return b("DataCollector").getMetadata()},addTaskSubscribers:function(a){k._taskSubscribers=k._taskSubscribers.concat(a)},getTaskSubscribers:function(){return k._taskSubscribers},addTaskTags:function(a){k._taskTags=k._taskTags.concat(a)},getTaskTags:function(){return k._taskTags},reset:function(){b("DataCollector").reset(),k._reactRoots.forEach(function(a){b("ReactDOM").unmountComponentAtNode(a,e.id)}),k._reactRoots=[],k._taskTags=[]},cancel:function(){var a=k._dialog;k._dialog=null;k.reset();a&&a.hide()},initForm:function(a,c){a=b("nullthrows")(a.form,"Form is absent");k._form=a;if(c){var d;(d=k._reactRoots).push.apply(d,c)}k.initFormField(a.elements.logs);k.initFormField(a.elements.metadata);setTimeout(k.setProductAreaFocus,0)},isPotentialVideoDecodingReport:function(){var a="269405676539001",b=k._form.descr,c=k._form.product_category_id;if(!c||c.options===void 0||c.selectedIndex===void 0)return!1;c=c.options[c.selectedIndex];return c.value===a?b.value.search(/decoding|artifact|green|pixel|flicker|flashing|flashed/i)>-1:!1},initFormField:function(a){var c;if(a.name=="logs")try{a.value=b("DataCollector").collectLogs()}catch(a){b("ODS").bumpEntityKey(2966,"flytrap","client_log_failed")}else if(a.name=="metadata")try{c=b("DataCollector")._collectMetadata(),a.value=JSON.stringify(c)}catch(a){b("ODS").bumpEntityKey(2966,"flytrap","metadata_log_failed")}},initNub:function(a){k._nub=a},initScreenshotUploader:function(a,c){k._fileHandle=a;if(c){c=k._dialog;c=b("DOM").scry(c.getRoot(),"button");a.setSubmitButtons(c)}},initDescription:function(a){b("Event").listen(a,"paste",function(a){return k._handleDescriptionPaste(a)})},_handleDescriptionPaste:function(a){var c=a.clipboardData.items;if(!c||!k._fileHandle)return;var d={};for(var e=0;e<c.length;e++)if(c[e].kind==="file"&&c[e].type.startsWith("image/index.html")){var f=c[e].getAsFile(),h=/\.[^.]+$|$/.exec(f.name)[0];d["file"+e]=new File([f],g._("Pasted image {timestamp}",[g._param("timestamp",new Date().toISOString())])+h,{type:c[e].type})}(i||(i=b("isEmpty")))(d)||(k._fileHandle.addFilesAndSend(d),a.preventDefault())},setProductAreaFocus:function(){var a=b("DOM").scry(document.body,"select#product_category");a&&a.length&&a[0].focus()},taskCreated:function(a,c){k.cancel(),b("SimpleXUIDialog").show(c,a)},subscribeSubmit:function(a,c){k._dialog=a;var d=!1;a.subscribe(["cancel","hide"],function(){d&&(b("ScreenRecordingActions").clearScreenRecordings(),d=!1),k.cancel()});a.subscribe(["submit"],function(){d=!0;if(k.isPotentialVideoDecodingReport()){var a=b("DOM").scry(k._form,"#bug_report_decoding_artifacts")[0];if(a&&!b("CSS").shown(a)){b("CSS").show(a);d=!1;return!1}}if(k._form.duplicate_task_id){a=k._form.duplicate_task_id.value;if(a){a="Another report of bug: "+k._duplicate_task_title;b("Input").isEmpty(c)||(a=a+"\n\nAdditional description: "+c.value);b("Input").setValue(c,a)}}if(b("Input").getValue(c).length<4){b("CSS").show(b("$")("bug_report_warning"));b("DOM").setContent(b("ge")("bug_report_warning"),g._("Please provide more details about the problem you are experiencing."));d=!1;return!1}if(k._form.product_category_id.value=="100977986739334"){b("CSS").show(b("$")("bug_report_warning"));b("DOM").setContent(b("ge")("bug_report_warning"),g._("Please select a product."));d=!1;return!1}if(k._form.querySelector('input[name="rank_bug"]:checked')){a=k._form.querySelector('input[name="rank_bug"]:checked');var e=c.value;e+="\n\nThis search result should be ranked: "+a.value;b("Input").setValue(c,e)}return!0})},fillSavedDescription:function(a){a=b("ge")(a),k._savedInput=k._savedInput||"Sorry, we lost your original description :(",b("DOM").setContent(a,k._savedInput)},hide:function(){if(k._dialog){b("CSS").hide(k._dialog.getRoot());return!0}return!1},unhide:function(){if(k._dialog){b("CSS").show(k._dialog.getRoot());var a=JSON.parse(k._form.debuginfo.value);a.additionalmetadata=a.additionalmetadata||{};Object.assign(a.additionalmetadata,k.getMetadata());k._form.debuginfo.value=JSON.stringify(a);return!0}return!1},serialize:function(){var a=function(a){a=k._form.querySelector(a);return a?a.value:null},b=a('[name="client_notifs"]'),c=a('[name="config_id"]'),d=a('[name="isTimeline"]'),e=a('[name="feed_story_identifier"]'),f=a('[name="feed_story_location"]'),g=a('[name="feed_story_object_class"]'),h=a('[name="feed_story_serialized"]'),i=a('[name="notif_alert_id"]'),j=a('[name="product_category_id"]');a=a('[name="source"]');return{client_notifs:b,config_id:c,defaultText:k._form.descr.value,isTimeline:d,feed_story_identifier:e,feed_story_location:f,feed_story_object_class:g,feed_story_serialized:h,notif_alert_id:i,product_category_id:j,source:a}},openBugDialog:function(a,c){c===void 0&&(c=!1);if(k._dialog)return!1;a=new(b("AsyncRequest"))(a);c&&a.setData({file_upload_disabled:!0});b("AsyncDialog").send(a,function(a){return a.subscribe("cancel",k.cancel)});return!0},registerMeToo:function(a,c,d,e,f){b("Event").listen(a,"click",function(a){b("CSS").show(b("$")("bug_report_warning")),b("DOM").setContent(b("ge")("bug_report_warning"),["When you submit this bug report, it will be merged into task ",b("DOM").create("a",{href:f},"#"+d+": "+e),". It is optional to include a description. Please hit submit!"]),k._form.duplicate_task_id.value=d,k._duplicate_task_title=e})},setNubLevel:function(a){k._nub?(k._nubClasses.forEach(function(a){return b("CSS").removeClass(k._nub,a)}),b("CSS").addClass(k._nub,k._nubClasses[a])):b("FBLogger")("flytrap").warn("The nub element hasn't been initialized")},prepareJSErrors:function(a){var b=55,c=5,d={},e=[];for(a of a){var f=a.message&&a.message.substring(0,b)||"";e.length<c&&e.indexOf(f)===-1&&e.push(f);!d[f]?d[f]=1:d[f]++}return e.map(function(a){return a+": "+d[a]}).join(", ")},summarizeJSErrors:function(a){var c=k.prepareJSErrors((j||(j=b("ErrorUtils"))).history);b("Input").setValue(a,c)},summarizeSWErrors:function(a){b("promiseDone")(b("ServiceWorkerErrorUtils").getHistory().then(function(c){c=k.prepareJSErrors(c);b("Input").setValue(a,c)}))}};e.exports=k}),null);